{% extends "base.html" %}
{% block title %}Importa Diagramma BPMN{% endblock %}

{% block content %}
<div class="container py-4">
  <h2 class="text-center mb-4">üì• Importa Supply Chain Data View</h2>

  <!-- Upload file -->
  <div class="mb-3">
    <label class="form-label">Carica file BPMN:</label>
    <input type="file" id="bpmnFile" class="form-control" accept=".bpmn,.xml">
  </div>

  <!-- Azioni -->
  <div class="mt-4 text-center">
    <button id="uploadBtn" class="btn btn-success">üíæ Importa e Modifica</button>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  let fileContent = null;

  document.getElementById('bpmnFile').addEventListener('change', async function () {
    const file = this.files[0];
    if (!file) return;
    fileContent = await file.text();
  });

  document.getElementById('uploadBtn').addEventListener('click', async () => {
    if (!fileContent) return alert("‚ö†Ô∏è Nessun file selezionato.");

    const name = prompt("Inserisci un nome per il diagramma:");
    if (!name) return;

    const res = await fetch('/importer/upload/', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, xml_content: fileContent })
    });

    if (res.ok) {
      const data = await res.json();
      window.location.href = `/editor/?id=${data.id}`;  // editor.js si occuper√† di tutto
    } else {
      alert("‚ùå Errore durante l'import.");
    }
  });
</script>
{% endblock %}
